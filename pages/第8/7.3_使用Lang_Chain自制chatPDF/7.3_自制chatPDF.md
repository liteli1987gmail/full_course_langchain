
# ç”¨ LangChain è‡ªåˆ¶ chatPDF

æˆ‘ä»¬è¿™ä¸ª ChatPDF é¡¹ç›®æ˜¯å¼•å…¥å¤–éƒ¨æ•°æ®é›†å¯¹å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œä»¥ç”Ÿæˆæ›´å‡†ç¡®çš„å›ç­”çš„ç¨‹åºã€‚

è¯•æƒ³ä½ æ˜¯ä¸€ä¸ªèˆªå¤©é£æœºè®¾è®¡å¸ˆï¼Œä½ éœ€è¦äº†è§£æœ€æ–°çš„èˆªç©ºææ–™æŠ€æœ¯ï¼Œä½ å¯ä»¥å°†è¿™ä¸ªéœ€æ±‚è¾“å…¥åˆ°æˆ‘ä»¬çš„æ¨¡å‹ä¸­ï¼Œæ¨¡å‹å°±ä¼šæ ¹æ®æœ€æ–°çš„æ•°æ®é›†ç»™å‡ºå‡†ç¡®çš„ç­”æ¡ˆã€‚

æˆ‘ä»¬çš„ç•Œé¢å‘ˆç°çš„æ˜¯äººç±»ä¸æ–‡æ¡£é—®ç­”çš„èŠå¤©ï¼Œä½†å®è´¨ä¸Šï¼Œæˆ‘ä»¬ä»ç„¶æ˜¯åœ¨ä¸å¤§è¯­è¨€æ¨¡å‹äº¤æµï¼Œåªä¸è¿‡è¿™ä¸ªæ¨¡å‹ç°åœ¨è¢«èµ‹äºˆäº†æ¥å…¥å¤–éƒ¨æ•°æ®é›†çš„èƒ½åŠ›ã€‚å°±åƒä½ åœ¨ä¸ä¸€ä½ç†Ÿæ‚‰ä½ å…¬å¸å†…éƒ¨æ–‡æ¡£çš„åŒäº‹äº¤è°ˆï¼Œå°½ç®¡ä»–å¯èƒ½å¹¶æœªå‚ä¸è¿‡è¿™äº›æ–‡æ¡£çš„ç¼–å†™ï¼Œä½†ä»–å¯ä»¥å‡†ç¡®åœ°å›ç­”ä½ çš„é—®é¢˜ã€‚

å¤§è¯­è¨€æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸èƒ½åƒèŠå¤©ä¸€æ ·ä¸æ–‡æ¡£äº¤æµï¼Œæˆ‘ä»¬åªèƒ½ä¾èµ–äºæœç´¢ã€‚ä¾‹å¦‚, ä½ æ­£åœ¨ä¸ºä¸€é¡¹é‡è¦çš„æŠ¥å‘Šå¯»æ‰¾èµ„æ–™ï¼Œä½ å¿…é¡»çŸ¥é“ä½ éœ€è¦æŸ¥æ‰¾çš„å…³é”®è¯ï¼Œç„¶ååœ¨å¤§é‡çš„ä¿¡æ¯ä¸­ç­›é€‰å‡ºä½ éœ€è¦çš„éƒ¨åˆ†ã€‚è€Œç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èŠå¤©çš„æ–¹å¼ï¼Œå³ä½¿ä¸çŸ¥é“å…·ä½“çš„å…³é”®è¯ï¼Œä¹Ÿå¯ä»¥è®©æ¨¡å‹æ ¹æ®æˆ‘ä»¬çš„é—®é¢˜å‘Šè¯‰æˆ‘ä»¬ç­”æ¡ˆã€‚å°±å¥½åƒä½ åœ¨é—®ä¸€ä½ä¸“ä¸šçš„å›¾ä¹¦é¦†å‘˜ï¼Œå“ªäº›ä¹¦ç±å¯ä»¥å¸®åŠ©ä½ å®Œæˆè¿™ä»½æŠ¥å‘Šã€‚

é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å¼•å…¥æ–‡æ¡£çš„å¤–éƒ¨æ•°æ®é›†å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¤§è¯­è¨€æ¨¡å‹çš„è®­ç»ƒæ•°æ®æˆªæ­¢åˆ° 2021 å¹´ 9 æœˆï¼Œä¹‹åäº§ç”Ÿçš„çŸ¥è¯†å’Œä¿¡æ¯å¹¶æœªè¢«åŒ…å«è¿›å»ã€‚å°±åƒæˆ‘ä»¬çš„æ¨¡å‹æ˜¯ä¸€ä¸ªç”Ÿæ´»åœ¨è¿‡å»çš„æ—¶é—´æ—…è¡Œè€…ï¼Œä»–åªèƒ½å‘Šè¯‰ä½ ä»–ç¦»å¼€çš„é‚£ä¸ªæ—¶åˆ»ä¹‹å‰çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¯¹ä¹‹åçš„äº‹æƒ…ä¸€æ— æ‰€çŸ¥ã€‚

æˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒæ•°æ®ä¸ä»…åŒ…å«å‚æ•°ï¼Œä¹Ÿå¼•å…¥äº†å¤–éƒ¨æ•°æ®é›†è¿›è¡Œè®­ç»ƒã€‚å°±å¥½åƒæˆ‘ä»¬é€šè¿‡ç”µè¯ï¼Œå‘ä¸€ä¸ªåœ¨è¿œæ–¹çš„æœ‹å‹è®²è¿°æœ€æ–°çš„æ–°é—»ï¼Œè¿™æ ·ä»–å°±å¯ä»¥äº†è§£åˆ°æœ€æ–°çš„äº‹æƒ…ã€‚æˆ‘ä»¬çš„å¤§è¯­è¨€æ¨¡å‹ä¹Ÿä¸€æ ·ï¼Œé€šè¿‡å¤–éƒ¨æ•°æ®é›†çš„è¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å®ƒäº†è§£åˆ°æœ€æ–°çš„ä¿¡æ¯ï¼Œä»è€Œè¿›è¡Œæ›´å¥½çš„æ£€ç´¢å¢å¼ºå’Œå¾®è°ƒï¼Œé€‚åº”æˆ‘ä»¬çš„å®æ—¶éœ€æ±‚ã€‚

å¼•å…¥å¤–éƒ¨æ•°æ®é›†è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç›®çš„ï¼Œé‚£å°±æ˜¯ä¿®å¤å¤§è¯­è¨€æ¨¡å‹çš„ "æœºå™¨å¹»è§‰"ï¼Œé¿å…ç»™å‡ºé”™è¯¯çš„å›ç­”ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ å‘ä¸€ä¸ªåªçŸ¥é“è¿‡å»ä¿¡æ¯çš„äººè¯¢é—®æœªæ¥çš„è¶‹åŠ¿ï¼Œä»–å¯èƒ½ä¼šåŸºäºè¿‡å»çš„ä¿¡æ¯è¿›è¡Œæ¨æ–­ï¼Œä½†è¿™æ ·çš„ç­”æ¡ˆæœªå¿…æ­£ç¡®ã€‚æ‰€ä»¥æˆ‘ä»¬é€šè¿‡å¼•å…¥æœ€æ–°çš„æ•°æ®ï¼Œè®©æˆ‘ä»¬çš„æ¨¡å‹èƒ½å¤Ÿæ›´å‡†ç¡®åœ°å›ç­”é—®é¢˜ï¼Œé¿å…å› ä¸ºä¿¡æ¯è¿‡æ—¶äº§ç”Ÿçš„è¯¯å¯¼ã€‚

æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ•°æ®æ–‡æ¡£å½¢å¼åŒ…æ‹¬ pdfã€jsonã€wordã€excel ç­‰ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬è·å–å®æ—¶çŸ¥è¯†å’Œæ•°æ®çš„é€”å¾„ã€‚è¿™ç±»ç¨‹åºç°åœ¨éå¸¸å—æ¬¢è¿ï¼Œæ¯”å¦‚æœ€è‘—åçš„ chatpdf å’Œ chatdoc, è¿˜æœ‰é’ˆå¯¹å„ç§ç‰¹å®šé¢†åŸŸçš„ç¨‹åºï¼Œå¦‚é’ˆå¯¹æ³•å¾‹æ–‡æ¡£çš„ç¨‹åºã€‚å°±åƒä½ åœ¨é˜…è¯»å„ç§æ ¼å¼çš„ä¹¦ç±ä¸€æ ·ï¼Œä¸åŒçš„ç¨‹åºèƒ½å¤Ÿæä¾›ä¸åŒçš„çŸ¥è¯†å’Œä¿¡æ¯ã€‚



### 7.3.1 ç¨‹åºæµç¨‹

æˆ‘ä»¬çš„å®ç°æ–¹å¼æ˜¯åˆ©ç”¨ Langchain å·²å®ç°çš„å‘é‡å­˜å‚¨ã€åµŒå…¥ä»¥åŠä½¿ç”¨æŸ¥è¯¢å’Œæ£€ç´¢ç›¸å…³çš„é“¾ï¼Œæ¥è·å–å¤–éƒ¨æ•°æ®é›†ï¼Œå¤„ç†æ–‡æ¡£ï¼Œè¿›è¡Œç›¸å…³æ€§æ£€ç´¢ååˆå¹¶å¤„ç†ï¼Œç½®å…¥å¤§è¯­è¨€æ¨¡å‹çš„æç¤ºæ¨¡æ¿ä¸­ï¼Œå®ç°ä¸ PDF æ–‡ä»¶äº¤æµçš„ç›®çš„ã€‚

æˆ‘ä»¬é€‰å®šçš„æ–‡æ¡£æ˜¯ Reid Hoffman å†™çš„ä¸€æœ¬å…³äº GPT-4 å’Œäººå·¥æ™ºèƒ½çš„ä¹¦ï¼Œæˆ‘ä»¬å°†ä¸‹è½½è¿™æœ¬ PDF å¹¶å°†å…¶è½¬åŒ–ä¸ºå¯æŸ¥è¯¢å’Œäº¤äº’çš„å½¢å¼ã€‚

#### åŠ è½½æ–‡ä»¶ä¸”åˆ‡åˆ†å—

é¦–å…ˆï¼Œæˆ‘ä»¬è¦åŠ è½½ PDF æ–‡ä»¶ï¼Œå¹¶å°†å…¶åˆ†å‰²æˆå—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå‘é‡å­˜å‚¨ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆåƒä½¿ç”¨æœç´¢å¼•æ“ï¼Œæˆ‘ä»¬åœ¨å‘é‡å­˜å‚¨ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹ï¼Œä½†ä¸åŸºäºå…³é”®è¯çš„æœç´¢ä¸åŒï¼Œæˆ‘ä»¬æ˜¯åŸºäºè¯­ä¹‰çš„ã€‚

#### åµŒå…¥å’Œå‘é‡å­˜å‚¨

ä¸ºæ¯ä¸ªå—åˆ›å»ºåµŒå…¥ï¼Œè¿™ä¸ªåµŒå…¥ä¼šæ˜¯ä¸€ä¸ªå‘é‡ï¼Œä»£è¡¨è¯¥å—ä¸­çš„æ‰€æœ‰ä¿¡æ¯ã€‚å½“æˆ‘ä»¬éœ€è¦æŸ¥è¯¢æŸä¸ªä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†é—®é¢˜åµŒå…¥ä¸ºä¸€ä¸ªå‘é‡ï¼Œç„¶åå‘é€ç»™å‘é‡å­˜å‚¨å™¨ã€‚å‘é‡å­˜å‚¨å™¨ä¼šè¿”å›æœ€ç›¸å…³çš„ä¿¡æ¯å—ï¼Œç„¶åå°†å…¶ä¸é—®é¢˜ä¸€èµ·ä¼ é€’ç»™è¯­è¨€æ¨¡å‹ã€‚

#### è¯­è¨€æ¨¡å‹ I/O

è¯­è¨€æ¨¡å‹ä¼šé˜…è¯»è¿™äº›ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯å†³å®šç­”æ¡ˆæ˜¯ä»€ä¹ˆã€‚è¿™ç§åŸºäºè¯­ä¹‰æœç´¢çš„æ¦‚å¿µå¹¶ä¸æ–°ï¼Œç”šè‡³ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹æ¥æŸ¥è¯¢æ–‡æœ¬çš„æƒ³æ³•ä¹Ÿå·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´äº†ã€‚

#### LangChain åˆ›å»ºé“¾

æˆ‘ä»¬éœ€è¦åšçš„å…³é”®æ­¥éª¤åŒ…æ‹¬ï¼šåŠ è½½æ–‡æ¡£ï¼Œåˆ†å‰²æ–‡æ¡£ï¼Œåˆ›å»ºåµŒå…¥ï¼Œå°†åµŒå…¥æ”¾å…¥å‘é‡å­˜å‚¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ LangChain åˆ›å»ºæˆ‘ä»¬çš„é“¾ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥æ‰¾å‘é‡å­˜å‚¨ä¸­çš„ä¿¡æ¯ï¼Œå°†å…¶å¸¦å…¥é“¾ä¸­ï¼Œç„¶åä¸é—®é¢˜ç»“åˆï¼Œæœ€ç»ˆå¾—å‡ºä¸€ä¸ªç­”æ¡ˆã€‚



### 7.3.2 ç¯å¢ƒå’Œå·¥å…·

#### å®‰è£…åŒ…
```
!pip -q install langchain openai tiktoken PyPDF2 faiss-cpu

```
#### è®¾ç½®å¯†é’¥
```

import os

os.environ["OPENAI_API_KEY"] = ""
```

#### ä¸‹è½½ PDF æ–‡æœ¬ 
```
# å¯ä»¥å¤åˆ¶åˆ°æµè§ˆå™¨åï¼Œç›´æ¥ä¿å­˜åœ¨æœ¬åœ°ç”µè„‘ä¸Šã€‚
!wget -q https://www.impromptubook.com/wp-content/uploads/2023/03/impromptu-rh.pdf
```

### å¯¼å…¥åº“å’Œ PDF åŠ è½½å™¨

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª PDF é˜…è¯»å™¨ã€‚è™½ç„¶æˆ‘ä»¬è¿™æ¬¡åªä½¿ç”¨äº†ä¸€ä¸ªåŸºç¡€çš„ PDF é˜…è¯»å™¨ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æ›´åˆé€‚çš„ PDF é˜…è¯»å™¨ã€‚æˆ‘ä»¬é€šè¿‡ PDF é˜…è¯»å™¨å°† PDF æ–‡æ¡£è¯»å–æˆä¸€ä¸ªé•¿å­—ç¬¦ä¸²ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ ¼å¼é—®é¢˜ï¼Œæ¯”å¦‚å¥‡æ€ªçš„ç©ºæ ¼ç­‰ï¼Œä½†æ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„æ•°æ®å¤„ç†æ–¹æ³•ã€‚ä¸è®ºæ˜¯ä½¿ç”¨åŸºç¡€çš„å¤„ç†æ–¹å¼ï¼Œè¿˜æ˜¯ä½¿ç”¨è¯¸å¦‚'unstructured'åº“ã€AWS æˆ– Google Cloud çš„ APIï¼Œéƒ½æœ‰å¯èƒ½ã€‚


å…ˆå¯¼å…¥é˜…è¯»å™¨ `PdfReader`, åµŒå…¥æ¨¡å‹ `OpenAIEmbeddings`, æ–‡æ¡£åˆ‡åˆ†å™¨ `CharacterTextSplitter`, å‘é‡å­˜å‚¨åº“ `FAISS`  ï¼š 

```
from PyPDF2 import PdfReader
from langchain.embeddings.openai import OpenAIEmbeddings
from langchain.text_splitter import CharacterTextSplitter
from langchain.vectorstores import FAISS 
```

åŠ è½½ä¹‹å‰å‡†å¤‡å¥½çš„ PDF ç´ æï¼š

```
# æ‹¬å·å†…å¡«å…¥å½“å‰ç”µè„‘ä¿å­˜pdfæ–‡ä»¶çš„ä½ç½®. 
doc_reader = PdfReader('/content/impromptu-rh.pdf')
```
æ‰“å° `doc_reader` çœ‹çœ‹ :
```
<PyPDF2._reader.PdfReader at 0x7f119f57f640>
```
å°† PDF æ–‡æ¡£è½¬åŒ–ä¸ºå¯ç”¨çš„ `raw_text` æ ¼å¼ï¼š

```
# read data from the file and put them into a variable called raw_text
raw_text = ''
for i, page in enumerate(doc_reader.pages):
    text = page.extract_text()
    if text:
        raw_text += text
```     
æˆ‘ä»¬å¯ä»¥æ‰“å° `raw_text` çš„ç»“æœå­—ç¬¦ä¸²é•¿åº¦ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è½¬æ¢æˆåŠŸäº†ï¼š

```
len(raw_text) # å¾—åˆ° 356710 çš„ç»“æœ
```


### 7.3.3 æ–‡æœ¬æ‹†åˆ†

æˆ‘ä»¬éœ€è¦å°†è·å–åˆ°çš„é•¿å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºé€‚åˆåˆ†æçš„å°æ®µè½ã€‚

æˆ‘ä»¬çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å°†è¿™ä¸ªé•¿å­—ç¬¦ä¸²æŒ‰ç…§å­—ç¬¦æ•°æ‹†åˆ†ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è®¾å®šæ¯ 1000 ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªå—, `chunk_size = 1000`ã€‚


```

# Splitting up the text into smaller chunks for indexing
text_splitter = CharacterTextSplitter(        
    separator = "\n",
    chunk_size = 1000,
    chunk_overlap  = 200, #striding over the text
    length_function = len,
)
texts = text_splitter.split_text(raw_text)

```

æˆ‘ä»¬æ€»å…±åˆ‡äº† 448 ä¸ªå—ï¼š

```
len(texts) # 448
``` 

*æ³¨æ„*ï¼š åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œ`chunk_overlap` å‚æ•°ç”¨äºæŒ‡å®šæ–‡æœ¬åˆ‡åˆ†æ—¶çš„é‡å é‡ï¼ˆoverlapï¼‰ã€‚å®ƒè¡¨ç¤ºåœ¨åˆ‡åˆ†åç”Ÿæˆçš„æ¯ä¸ªåˆ†å—ä¹‹é—´é‡å çš„å­—ç¬¦æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºæ¯ä¸ªåˆ†å—çš„å‰åï¼Œä¸¤ä¸ªåˆ†å—ä¹‹é—´ä¼šæœ‰å¤šå°‘ä¸ªå­—ç¬¦æ˜¯é‡å¤çš„ã€‚ä¸¾ä¾‹æ¥è¯´ chunkA å’Œ chunkB, ä»–ä»¬æœ‰ 200 ä¸ªå­—ç¬¦æ˜¯é‡å¤çš„ã€‚

ç„¶åï¼Œæˆ‘ä»¬é‡‡ç”¨æ»‘åŠ¨çª—å£çš„æ–¹æ³•æ¥æ‹†åˆ†æ–‡æœ¬ã€‚å³æ¯ä¸ªå—ä¹‹é—´ä¼šæœ‰éƒ¨åˆ†å­—ç¬¦é‡å ï¼Œæ¯”å¦‚åœ¨æ¯ 1000 ä¸ªå­—ç¬¦çš„å—ä¸Šï¼Œæˆ‘ä»¬è®©å‰åä¸¤å—æœ‰ 200 ä¸ªå­—ç¬¦é‡å ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…å…³é”®ä¿¡æ¯è¢«åˆ‡åˆ†ï¼Œè€Œä¸”å³ä½¿æœ‰äº›ä¿¡æ¯å‡ºç°åœ¨äº†å¤šä¸ªå—ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨è·å–æ•´ä½“è¯­ä¹‰ï¼Œæ‰€ä»¥è¿™äº›é‡å çš„å—åœ¨è¯­ä¹‰ä¸Šä¹Ÿä¼šæœ‰æ‰€åŒºåˆ«ã€‚

æˆ‘ä»¬å¯ä»¥éšæœºæ‰“å°ä¸€å—çš„å†…å®¹ï¼š

```
texts[20]
```

è¾“å‡ºæ˜¯ï¼š

```
'million registered users. \nIn late January 2023, Microsoft1â€”which had invested $1 billion \nin OpenAI in 2019â€”announced that it would be investing $10 \nbillion more in the company. It soon unveiled a new version of \nits search engine Bing, with a variation of ChatGPT built into it.\n1 I sit on Microsoftâ€™s Board of Directors. 10Impromptu: Amplifying Our Humanity Through AI\nBy the start of February 2023, OpenAI said ChatGPT had \none hundred million monthly active users, making it the fast-\nest-growing consumer internet app ever. Along with that \ntorrent of user interest, there were news stories of the new Bing \nchatbot functioning in sporadically unusual ways that were \nvery different from how ChatGPT had generally been engaging \nwith usersâ€”including showing â€œanger,â€ hurling insults, boast-\ning on its hacking abilities and capacity for revenge, and basi-\ncally acting as if it were auditioning for a future episode of Real \nHousewives: Black Mirror Edition .'
```



### 7.3.4  åˆ›å»ºåµŒå…¥å’Œæ£€ç´¢

æœ‰äº†åˆ†å¥½çš„å°å—æ–‡æœ¬ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºè¿™äº›æ–‡æœ¬åˆ›å»ºåµŒå…¥äº†ã€‚åœ¨è¿™ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† OpenAI çš„åµŒå…¥æŠ€æœ¯ã€‚

```
# Download embeddings from OpenAI
embeddings = OpenAIEmbeddings()
```
æˆ‘ä»¬å…ˆæŠŠæ–‡æœ¬ä¼ ç»™åµŒå…¥åˆ¶é€ å™¨ï¼Œç„¶åé€šè¿‡ FAISS åº“åˆ›å»ºå‘é‡å­˜å‚¨æœ¬èº«ã€‚

```
docsearch = FAISS.from_texts(texts, embeddings)
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å°†åŸæœ¬çš„ PDF æ–‡æ¡£è½¬åŒ–ä¸ºäº†å¯ä»¥è¿›è¡Œæœºå™¨å­¦ä¹ çš„å‘é‡æ•°æ®ã€‚

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å‘è¿™ä¸ª PDF é—®é—®é¢˜äº†ã€‚

### ç›¸ä¼¼åº¦æ£€ç´¢

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å‘é‡æ•°æ®æ¥è¿›è¡Œæœç´¢åŒ¹é…äº†ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ªå®é™…çš„æŸ¥è¯¢ä¸ºä¾‹ï¼šâ€œGPT-4 å¦‚ä½•æ”¹å˜ç¤¾äº¤åª’ä½“ï¼Ÿâ€ã€‚

```
query = "how does GPT-4 change social media?"
docs = docsearch.similarity_search(query) # è¿™æ˜¯æœç´¢åŒ¹é…çš„æ–‡å­—ç»“æœæ•°ç»„ã€‚
```

æˆ‘ä»¬æŠŠè¿™ä¸ªæŸ¥è¯¢ä¼ ç»™æ–‡æ¡£æœç´¢ç³»ç»Ÿï¼Œä½¿ç”¨ç›¸ä¼¼åº¦åŒ¹é…æœç´¢ `similarity_search`ï¼Œåœ¨å‘é‡æ•°æ®ä¸­å¯»æ‰¾ä¸æŸ¥è¯¢æœ€åŒ¹é…çš„æ–‡æ¡£ã€‚

æˆ‘ä»¬çš„æœç´¢ç»“æœå°†åŒ…æ‹¬ä¸æŸ¥è¯¢æœ€æ¥è¿‘çš„å››ä¸ªæ–‡æ¡£ï¼Œè€Œè¿™äº›æ–‡æ¡£éƒ½æ˜¯é€šè¿‡æˆ‘ä»¬çš„åµŒå…¥å‡½æ•°è¿›è¡ŒåµŒå…¥çš„ã€‚

```

len(docs)  # ç»“æœä¸º 4 ä»£è¡¨æœ‰ 4 å¤„åœ°æ–¹è·Ÿé—®é¢˜æœ‰å…³ç³»

```

æˆ‘ä»¬å°è¯•æ‰“å°ç¬¬ä¸€ä¸ª `docs[0]`
åœ¨æˆ‘ä»¬çš„æœç´¢ç»“æœä¸­ï¼Œé¦–ä½çš„æ–‡æ¡£ä¸­å¤šæ¬¡æåˆ°äº†â€œç¤¾äº¤åª’ä½“â€ï¼Œçœ‹æ¥æˆ‘ä»¬çš„æŸ¥è¯¢æ•ˆæœè¿˜æ˜¯å¾ˆå¥½çš„ã€‚

```
Document(page_content='rected ways that tools like GPT-4 and DALL-E 2 enable.\nThis is a theme Iâ€™ve touched on throughout this travelog, but \nitâ€™s especially relevant in this chapter. From its inception, social \nmedia worked to recast broadcast mediaâ€™s monolithic and \npassive audiences as interactive, democratic communities, in \nwhich newly empowered participants could connect directly \nwith each other. They could project their own voices broadly, \nwith no editorial â€œgatekeepingâ€ beyond a given platformâ€™s terms \nof service.\nEven with the rise of recommendation algorithms, social media \nremains a medium where users have more chance to deter -\nmine their own pathways and experiences than they do in the \nworld of traditional media. Itâ€™s a medium where theyâ€™ve come \nto expect a certain level of autonomy, and typically they look for \nnew ways to expand it.\nSocial media content creators also wear a lot of hats, especially \nwhen starting out. A new YouTube creator is probably not only', metadata={})
```

è¿™å°±æ˜¯å¦‚ä½•åˆ©ç”¨ OpenAI æŠ€æœ¯å¤„ç† PDF æ–‡æ¡£ï¼Œå°†æµ·é‡çš„ä¿¡æ¯æç‚¼ä¸ºå¯ç”¨çš„æ•°æ®çš„å…¨éƒ¨æ­¥éª¤ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œèµ¶ç´§åŠ¨æ‰‹åšèµ·æ¥å§~

æˆ‘ä»¬ç°åœ¨åªæœ‰ä¸€ä¸ª PDF æ–‡æ¡£ï¼Œå®ç°ä»£ç ä¹Ÿå¾ˆç®€å•ï¼ŒLangchain ç»™äº†å¾ˆå¤šç»„ä»¶ï¼Œæˆ‘ä»¬å®Œæˆå¾—å¾ˆå¿«ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¤„ç†å¤šæ–‡æ¡£çš„æé—®ï¼Œç°å®æ˜¯æˆ‘ä»¬è¦è·å–åˆ°çœŸå®çš„ä¿¡æ¯ï¼Œé€šè¿‡ä¼šè·¨è¶Šå¤šä¸ªæ–‡æ¡£ï¼Œæ‰èƒ½æå–æœ‰ç”¨çš„ä¿¡æ¯ã€‚æ¯”å¦‚è¯»å–é‡‘èç ”æŠ¥ï¼Œæ–°é—»ç»¼åˆæŠ¥é“ç­‰ç­‰ã€‚


### 7.3.5  è¿›é˜¶ Stuff é“¾

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åŠ è½½äº†ä¸€ä¸ª PDF æ–‡æ¡£ï¼Œè½¬åŒ–æ ¼å¼ï¼Œåˆ‡åˆ†å­—ç¬¦åï¼Œåˆ›å»ºå‘é‡æ•°æ®æ¥è¿›è¡Œæœç´¢åŒ¹é…è·å¾—äº†é—®é¢˜çš„ç­”æ¡ˆã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†å·²ç»å¤„ç†å¥½çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ„å»ºä¸€ä¸ªç®€å•çš„é—®ç­”é“¾ã€‚ç°åœ¨æˆ‘ä»¬çœ‹çœ‹ å¦‚ä½•ä½¿ç”¨ Langchain æ„å»ºé—®ç­”é“¾ã€‚ 

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† OpenAI çš„æ¨¡å‹ï¼Œå¹¶é€‰æ‹©äº† Langchain çš„ç°æœ‰æ–‡æ¡£å¤„ç†é“¾ä¸­ ä¸€ç§è¢«ç§°ä¸º "stuff" çš„é“¾ç±»å‹ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯å°†æ‰€æœ‰å†…å®¹éƒ½æ”¾åœ¨ä¸€ä¸ªè°ƒç”¨ä¸­ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ”¾å…¥çš„å†…å®¹åº”è¯¥å°‘äº 4000 ä¸ªä»¤ç‰Œã€‚

é™¤äº† "stuff" ä¹‹å¤–ï¼ŒLangchain æ–‡æ¡£å¤„ç†é“¾è¿˜æœ‰ ç²¾åŒ–ï¼ˆRefineï¼‰ã€Map reduce ã€é‡æ’ï¼ˆMap re-rankï¼‰ã€‚åé¢æˆ‘ä»¬ä¼šå†æ¬¡ç”¨åˆ°ã€‚

```

from langchain.chains.question_answering import load_qa_chain
from langchain.llms import OpenAI
chain = load_qa_chain(OpenAI(), 
                      chain_type="stuff") # we are going to stuff all the docs in at once
```

### è¿è¡Œé“¾ï¼Œæ„å»ºæŸ¥è¯¢

ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦æ„å»ºæˆ‘ä»¬çš„æŸ¥è¯¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨å‘é‡å­˜å‚¨ä¸­è¿”å›çš„å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡ç‰‡æ®µæ¥å›ç­”æˆ‘ä»¬çš„é—®é¢˜ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæŸ¥è¯¢ä¼ ç»™è¯­è¨€æ¨¡å‹é“¾ã€‚è¯­è¨€æ¨¡å‹é“¾ä¼šå›ç­”è¿™ä¸ªæŸ¥è¯¢ï¼Œç»™å‡ºç›¸åº”çš„ç­”æ¡ˆã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé—® "è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯è°ï¼Ÿ"ï¼Œç„¶åå°†è¯¥æŸ¥è¯¢ä¼ é€’ç»™å‘é‡å­˜å‚¨è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚ç³»ç»Ÿä¼šè¿”å›æœ€ç›¸ä¼¼çš„å››ä¸ªæ–‡æ¡£ï¼Œæˆ‘ä»¬å°†è¿™äº›æ–‡æ¡£ä¼ é€’ç»™è¯­è¨€æ¨¡å‹é“¾å¹¶ç»™å‡ºæŸ¥è¯¢ï¼Œç„¶åç³»ç»Ÿä¼šç»™å‡ºä¸€ä¸ªç­”æ¡ˆã€‚

```
query = "who are the authors of the book?"
docs = docsearch.similarity_search(query)
chain.run(input_documents=docs, question=query)

```
çœ‹çœ‹ä»–å›ç­”äº†ä»€ä¹ˆ:

```
' The authors of the book are Reid Hoffman and Ben Casnocha.'
```


#### é€‰æ‹©è¿”å›çš„æ–‡æ¡£æ•°é‡

æˆ‘ä»¬å¯ä»¥è®¾ç½®è¿”å›çš„æ–‡æ¡£æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šè¿”å›å››ä¸ªæœ€ç›¸å…³çš„æ–‡æ¡£ï¼Œä½†æˆ‘ä»¬å¯ä»¥æ›´æ”¹è¿™ä¸ªæ•°å­—ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®è¿”å›å‰å…­ä¸ªæˆ–æ›´å¤šçš„æœç´¢ç»“æœã€‚

```
query = "who is the book authored by?"
docs = docsearch.similarity_search(query,k=6)
chain.run(input_documents=docs, question=query)
```

ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®è¿”å›çš„æ–‡æ¡£æ•°é‡è¿‡å¤š, æ¯”å¦‚è®¾ç½® `k=20`ï¼Œé‚£ä¹ˆæ€»çš„ä»¤ç‰Œæ•°å¯èƒ½ä¼šè¶…è¿‡æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œå¯¼è‡´é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä½ ä½¿ç”¨çš„æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ä¸º 4097ï¼Œä½†å¦‚æœæˆ‘ä»¬è¯·æ±‚çš„ä»¤ç‰Œæ•°è¶…è¿‡äº† 5000ï¼Œç³»ç»Ÿå°±ä¼šæŠ¥é”™ã€‚

è®¾ç½®è¿”å›çš„æ–‡æ¡£æ•°é‡ä¸º `k=6`ï¼Œæˆ‘ä»¬è·å–çš„ç»“æœæ˜¯ï¼š
```
' The book is authored by Reid Hoffman and Aria Finger.'
```

### 7.3.6  è¿›é˜¶ map_rerank é“¾

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹é“¾ç±»å‹ã€‚æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­çœ‹è¿‡è®¸å¤šä¸åŒçš„é“¾ç±»å‹ã€‚

"stuff" ç±»å‹ä¼˜åŠ¿æ˜¯æŠŠæ‰€æœ‰å†…å®¹éƒ½æ”¾åœ¨ä¸€èµ·çš„åœ°æ–¹ã€‚ä»»ä½•æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ "stuff"ï¼Œæœ€å¥½å°±ä½¿ç”¨å®ƒï¼Œé€šç”¨ä¸”èŠ‚çœæˆæœ¬ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ "map_reduce" åœ¨å¹¶è¡Œè®¡ç®—ä¸­å¯¹æ¯ä¸ªæ–‡æ¡£è¿›è¡Œæ“ä½œï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´å¯¹ API è¿›è¡Œè¿‡å¤šçš„è°ƒç”¨ï¼Œå¢åŠ æˆæœ¬ã€‚

ç»§ç»­æˆ‘ä»¬çš„è®¨è®ºï¼Œæˆ‘ä»¬å°†æ·±å…¥äº†è§£å¦‚ä½•é€šè¿‡ Langchain æŠ€æœ¯ä» PDF æ–‡æ¡£ä¸­æå–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºå¦‚ä½•å¤„ç†å¤šä¸ªæŸ¥è¯¢å’Œç†è§£è¿”å›ç»“æœã€‚

ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ä¸åŒç±»å‹çš„æŸ¥è¯¢é“¾ç±»å‹ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `map_rerank` è¿™ç§ç±»å‹ï¼Œæé«˜æŸ¥è¯¢çš„è´¨é‡ã€‚

##### `map_rerank` ä¼˜åŒ–æŸ¥è¯¢è´¨é‡

è®©æˆ‘ä»¬ä»æå‡ºæ›´å¤æ‚çš„æŸ¥è¯¢å¼€å§‹ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æƒ³è¦çŸ¥é“ "OpenAI æ˜¯ä»€ä¹ˆ"ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦è·å–å‰ 10 ä¸ªæœ€ç›¸å…³çš„æŸ¥è¯¢ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒOpenAI ä¼šè¿”å›å¤šä¸ªç­”æ¡ˆï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä¸åªè¿”å›ä¸€ä¸ªç­”æ¡ˆï¼Œè€Œæ˜¯æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚è¿”å›äº†æ¯ä¸ªæŸ¥è¯¢çš„ç­”æ¡ˆå’Œç›¸åº”çš„è¯„åˆ†ã€‚

```

from langchain.chains.question_answering import load_qa_chain

chain = load_qa_chain(OpenAI(), 
                      chain_type="map_rerank",
                      return_intermediate_steps=True
                      ) 

query = "who are openai?"
docs = docsearch.similarity_search(query,k=10)
results = chain({"input_documents": docs, "question": query}, return_only_outputs=True)
results
```

é‡è¦çš„å‚æ•°æ˜¯ `return_intermediate_steps=True`, è®¾ç½®è¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ° `map_rerank` æ˜¯å¦‚ä½•å¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œæ‰“åˆ†çš„ã€‚


#####  ç†è§£è¯„åˆ†ç³»ç»Ÿ

OpenAI æŠ€æœ¯å¯¹è¿”å›çš„æ¯ä¸ªæŸ¥è¯¢ç»“æœè¿›è¡Œäº†è¯„åˆ†ã€‚æ¯”å¦‚è¯´ï¼ŒOpenAI åœ¨è¿™æœ¬ä¹¦ä¸­è¢«å¤šæ¬¡æåŠï¼Œå› æ­¤å®ƒçš„è¯„åˆ†å¯èƒ½ä¼šæœ‰ 80 åˆ†ï¼Œ90 åˆ†ç”šè‡³ 100 åˆ†ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾ OpenAI å¯èƒ½é€‰æ‹©äº†è¯„åˆ†ä¸º 100 åˆ†çš„ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæŸ¥è¯¢ï¼Œç„¶åå°†å®ƒä»¬åˆå¹¶ï¼Œæœ€ç»ˆç»™å‡ºäº†æˆ‘ä»¬çš„è¾“å‡ºã€‚

```
{'intermediate_steps': [{'answer': ' OpenAI is an organization that released text-to-image generation tool DALL-E 2 and ChatGPT in April 2022 and are giving millions of users hands-on access to these AI tools.',
   'score': '80'},
  {'answer': ' OpenAI is a research laboratory whose founding goal is to develop technologies that put the power of AI directly into the hands of millions of people.',
   'score': '80'},
  {'answer': ' OpenAI is a research organization that develops and shares artificial intelligence tools for the benefit of humanity.',
   'score': '100'},
  {'answer': ' OpenAI is a technology company focused on using artificial intelligence to solve real-world problems.',
   'score': '80'},
  {'answer': ' OpenAI is a company co-founded by Sam Altman that is developing AI technologies and allowing individuals to participate in the development process.',
   'score': '90'},
  {'answer': ' OpenAI is a research laboratory that focuses on artificial intelligence technologies.',
   'score': '80'},
  {'answer': ' OpenAI is a non-profit artificial intelligence research company that was founded in 2015 with the goal of advancing digital intelligence in the way that is most likely to benefit humanity as a whole. ',
   'score': '90'},
  {'answer': ' OpenAI is a nonprofit artificial intelligence (AI) research organization. Microsoft invested $1 billion in OpenAI in 2019 and announced in late January 2023 that it would be investing an additional $10 billion.',
   'score': '100'},
  {'answer': ' OpenAI is an artificial intelligence research laboratory founded by Elon Musk and Sam Altman.',
   'score': '100'},
  {'answer': ' OpenAI is an artificial intelligence research laboratory founded in December 201It is a non-profit organization with the mission to ensure that artificial general intelligence (AGI) benefits all of humanity. ',
   'score': '90'}],
 'output_text': ' OpenAI is a research organization that develops and shares artificial intelligence tools for the benefit of humanity.'}
```

è¯„åˆ†åï¼Œæ¨¡å‹è¾“å‡ºä¸€ä¸ªæœ€ç»ˆçš„ç­”æ¡ˆ, `'score': '100'` å¾—åˆ† 100 çš„é‚£ä¸ªç­”æ¡ˆï¼š

```
results['output_text'] 
```

```
' OpenAI is a research organization that develops and shares artificial intelligence tools for the benefit of humanity.'
```

ä¸ºäº†ææ¸…æ¥šä¸ºä»€ä¹ˆæ¨¡å‹ä¼šè¯„åˆ†ï¼Œåšå‡ºåˆ¤æ–­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å° prompt æç¤ºæ¨¡æ¿ï¼š

```
# check the prompt
chain.llm_chain.prompt.template
```
çœ‹å®Œæ¨¡æ¿çš„ä¸€åˆ»ï¼Œä½ è‚¯å®šæœ‰æ‰€é¡¿æ‚Ÿï¼š

```
"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\nIn addition to giving an answer, also return a score of how fully it answered the user's question. This should be in the following format:\n\nQuestion: [question here]\nHelpful Answer: [answer here]\nScore: [score between 0 and 100]\n\nHow to determine the score:\n- Higher is a better answer\n- Better responds fully to the asked question, with sufficient level of detail\n- If you do not know the answer based on the context, that should be a score of 0\n- Don't be overconfident!\n\nExample #1\n\nContext:\n---------\nApples are red\n---------\nQuestion: what color are apples?\nHelpful Answer: red\nScore: 100\n\nExample #2\n\nContext:\n---------\nit was night and the witness forgot his glasses. he was not sure if it was a sports car or an suv\n---------\nQuestion: what type was the car?\nHelpful Answer: a sports car or an suv\nScore: 60\n\nExample #3\n\nContext:\n---------\nPears are either red or orange\n---------\nQuestion: what color are apples?\nHelpful Answer: This document does not answer the question\nScore: 0\n\nBegin!\n\nContext:\n---------\n{context}\n---------\nQuestion: {question}\nHelpful Answer:"
```


### 7.3.7  RetrievalQA é“¾

é™¤äº†å•ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨é“¾å¼æŸ¥è¯¢ã€‚æˆ‘ä»¬å¯ä»¥å¼€å§‹å°†è¿™äº›æŸ¥è¯¢æ”¾åœ¨ä¸€ä¸ªé“¾æ¡ä¸­ã€‚

é“¾å¼æŸ¥è¯¢æŒ‡çš„æ˜¯æŸ¥è¯¢å‘é‡å­˜å‚¨é“¾å’Œè¯­è¨€æ¨¡å‹çš„é“¾ã€‚

ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªæŸ¥è¯¢å‘é‡å­˜å‚¨çš„é“¾ï¼Œä»¥åŠä¸€ä¸ªæŸ¥è¯¢è¯­è¨€æ¨¡å‹çš„é“¾ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›é“¾æ¡ç»„åˆåœ¨ä¸€èµ·ï¼Œåˆ›å»ºä¸€ä¸ªæ£€ç´¢ QA é“¾æ¡ ã€‚


#### ä½¿ç”¨ RetrievalQA é“¾

RetrievalQA é“¾æ˜¯ Langchain å·²ç»å°è£…å¥½çš„ç´¢å¼•æŸ¥è¯¢é—®ç­”é“¾ã€‚å®ä¾‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠé—®é¢˜æ‰”ç»™å®ƒï¼Œè€Œä¸éœ€è¦ `chain.run()`ã€‚ç®€åŒ–äº†å¾ˆå¤šæ­¥éª¤ï¼Œè·å¾—äº†æ¯”è¾ƒç¨³å®šçš„æŸ¥è¯¢ç»“æœã€‚

ä¸ºäº†åˆ›å»ºè¿™æ ·çš„é“¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ£€ç´¢å™¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰è®¾ç½®å¥½çš„ docsearch, ä½œä¸ºæ£€ç´¢å™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è®¾ç½®è¿”å›çš„æ–‡æ¡£æ•°é‡ `"k":4`ã€‚

```
docsearch = FAISS.from_texts(texts, embeddings) # æ£€ç´¢å™¨æ˜¯å‘é‡åº“æ•°æ®
```

æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å‚æ•°ä¼ é€’ç»™é“¾æ¡ç±»å‹ "stuff"ï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬è¿”å›æºæ–‡æ¡£ã€‚ï¼ˆé€‰æ‹© "stuff" ç±»å‹çš„åŸå› ï¼šè·Ÿç¬¬ä¸€ä¸ª "stuff" ç±»å‹ å’Œ `map_reduce` ç±»å‹å¯¹æ¯”ç­”æ¡ˆçš„è´¨é‡ï¼‰ã€‚


```
from langchain.chains import RetrievalQA

# set up FAISS as a generic retriever 
retriever = docsearch.as_retriever(search_type="similarity", search_kwargs={"k":4})  # as_retrieveræ–¹æ³•æ˜¯æ„å»ºæ£€ç´¢å™¨ 

# create the chain to answer questions 
rqa = RetrievalQA.from_chain_type(llm=OpenAI(), 
                                  chain_type="stuff", 
                                  retriever=retriever, 
                                  return_source_documents=True)
```

#### è¿”å›ç»“æœå’Œæºæ–‡æ¡£

å½“æˆ‘ä»¬æŸ¥è¯¢ "OpenAI æ˜¯ä»€ä¹ˆ" æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…ä¼šå¾—åˆ°ä¸€ä¸ªç­”æ¡ˆï¼Œè¿˜ä¼šå¾—åˆ°æºæ–‡æ¡£ `source_documents`ã€‚æºæ–‡æ¡£æ˜¯è¿”å›ç»“æœçš„å‚è€ƒæ–‡æ¡£ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ç­”æ¡ˆæ˜¯å¦‚ä½•å¾—å‡ºçš„ã€‚

```
rqa("What is OpenAI?")
```

```
{'query': 'What is OpenAI?',
 'result': ' OpenAI is a research organization that develops and shares artificial intelligence tools for the benefit of humanity.',
 'source_documents': [Document(page_content='thing that has largely been happening to individuals rather \nthan for themâ€”an under-the-radar force deployed by Big Tech \nwithout much public knowledge, much less consent, via tech -\nnologies like facial recognition and algorithmic decision-mak-\ning on home loans, job applicant screening, social media rec-\nommendations, and more.\nA founding goal of OpenAI was to develop technologies that put \nthe power of AI directly into the hands of millions of people..... #ğŸ˜Šåé¢æˆ‘çœç•¥äº†ã€‚
```

#### ç›´æ¥è¿”å›ç»“æœè®¾ç½®

å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä¸­é—´æ­¥éª¤å’Œæºæ–‡æ¡£ï¼Œåªéœ€è¦æœ€ç»ˆç­”æ¡ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è¯·æ±‚è¿”å›ç»“æœã€‚å°†ä»£ç :

```
return_source_documents=True
```
æ”¹ä¸º
```
return_source_documents=False
```

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬é—® "What does gpt-4 mean for creativity?"

```
query = "What does gpt-4 mean for creativity?"
rqa(query)['result']
```
å®ƒä¼šç›´æ¥è¿”å›ç»“æœï¼Œä¸åŒ…æ‹¬æºæ–‡æ¡£ã€‚

```
' GPT-4 can amplify the creativity of humans by providing contextualized search, versatile brainstorming and production aid, and the ability to generate dialogue and branching narratives for interactive characters.'
```





